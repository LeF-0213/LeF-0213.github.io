---
layout: post
related_posts:
  - /backend/nodejs
title: "[Node.js] Socket.IO"
date: 2025-11-19
categories:
  - backend
  - nodejs
description: >

---
* toc
{:toc .large-only}



🌐 Server()에 대한 설명 (Socket.IO)Server()는 Node.js 환경에서 Socket.IO 서버 인스턴스를 생성하는 클래스(또는 함수)입니다. 이 인스턴스는 클라이언트와 실시간 양방향 통신을 설정하고 관리하는 중심 역할을 수행합니다.const io = new Server(server, options); 형태로 사용되며, 여기서 io가 바로 Socket.IO 서버 인스턴스입니다.1. ⚙️ Server()의 주요 역할Server() 인스턴스는 다음과 같은 핵심 기능을 담당합니다.HTTP 서버 연결 수용: 일반 HTTP 서버 인스턴스(server)를 인수로 받아 해당 서버의 포트를 통해 들어오는 실시간 통신 요청을 가로채고 처리합니다.핸드셰이크 및 업그레이드: 클라이언트가 Socket.IO 연결을 시도할 때, 초기 HTTP 핸드셰이크 요청을 처리하고, 가능하면 웹소켓(WebSocket) 프로토콜로 통신을 업그레이드하여 효율적인 연결을 수립합니다.이벤트 관리: 클라이언트로부터 들어오는 이벤트(예: '채팅 메시지 전송')를 수신하고, 서버에서 클라이언트로 이벤트를 보낼 수 있는 기능(예: '새 메시지 방송')을 제공합니다.네임스페이스 및 룸 관리: 여러 채널이나 그룹(예: '뉴스', '스포츠' 네임스페이스)을 만들어 통신을 분리하거나, 특정 사용자 그룹(룸)에게만 메시지를 전송하는 기능을 제공합니다.2. 📝 Server() 초기화 시 주요 인자new Server(server, options)에서 사용하는 주요 인자는 다음과 같습니다.인자설명필수/선택serverNode.js HTTP 서버 인스턴스입니다. 보통 Express 앱을 기반으로 생성한 http.createServer(app) 객체를 전달합니다. Socket.IO는 이 서버에 붙어 실시간 연결을 처리합니다.필수optionsSocket.IO 서버의 동작을 세부적으로 설정하는 설정 객체입니다.선택options 객체의 핵심 속성:cors: 다른 출처(Cross-Origin)의 클라이언트가 실시간 연결을 시도할 때 허용할지 정의합니다. (이전에 논의된 가장 중요한 설정)JavaScriptcors: {
  origin: "http://localhost:3000",
  methods: ["GET", "POST"]
}
path: Socket.IO 클라이언트가 연결할 서버 경로를 지정합니다. 기본값은 /socket.io/입니다.pingTimeout / pingInterval: 클라이언트와 서버가 연결을 유지하고 있는지 확인(Heartbeat)하는 시간 간격과 타임아웃을 설정합니다.3. 🖥️ 사용 예시 (코드와 역할)JavaScript// 1. http 모듈에서 필요한 함수 가져오기
const http = require('http'); 
const { Server } = require("socket.io"); // Socket.IO Server 클래스 가져오기
const express = require('express');

// 2. Express 앱 생성
const app = express(); 
const server = http.createServer(app); // Express 앱을 기반으로 HTTP 서버 생성

// 3. Socket.IO Server 인스턴스 생성 및 연결 (io)
const io = new Server(server, {
  cors: {
    origin: "http://localhost:3000"
  }
}); 

// 4. Socket.IO 이벤트 처리 시작
io.on('connection', (socket) => {
  // 클라이언트가 연결될 때마다 실행됨
  console.log('새로운 유저가 연결되었습니다.', socket.id);
  
  socket.on('disconnect', () => {
    console.log('유저가 연결을 끊었습니다.');
  });
});

// 5. 서버 리스닝
server.listen(4000, () => {
  console.log('서버가 4000번 포트에서 실행 중입니다.');
});
위 코드에서 생성된 io 객체가 바로 클라이언트와 실시간 소통하는 Socket.IO 서버이며, 서버 전체에 이벤트를 방송하거나 특정 소켓을 찾는 등 모든 실시간 통신을 이 객체를 통해 관리합니다.

🔑 credentials란 무엇인가요?웹 개발에서 credentials는 주로 **인증(Authentication)**과 관련된 정보를 주고받을 수 있도록 허용하는 옵션입니다. 이 옵션이 true로 설정되면, 클라이언트와 서버 간의 통신 시 다음과 같은 인증 정보를 포함할 수 있게 됩니다.1. 📋 포함되는 인증 정보 (Credentials)credentials: true로 설정했을 때 HTTP 요청에 포함될 수 있는 주요 정보는 다음과 같습니다:쿠키 (Cookies): 세션 관리, 사용자 설정, 또는 인증 토큰을 저장하는 데 사용되는 작은 데이터 조각입니다.HTTP 인증 헤더 (Authorization Headers): Bearer Token과 같은 직접적인 인증 토큰을 전달하는 데 사용됩니다.TLS 클라이언트 인증서 (TLS Client Certificates): 양방향 TLS 인증에서 사용됩니다 (덜 일반적).2. 🌍 CORS 설정에서의 역할credentials: true는 CORS (Cross-Origin Resource Sharing) 설정에서 특히 중요합니다.다른 출처(Cross-Origin) 간에 요청을 보낼 때, 브라우저는 보안상의 이유로 기본적으로 credentials를 포함하지 않습니다. 클라이언트가 서버로 인증 정보를 보내야 할 때, 클라이언트 측과 서버 측 모두에서 이 옵션을 명시적으로 활성화해야 합니다.설정 위치코드 예시역할서버 (Express/Socket.IO)cors: { credentials: true }서버가 다른 출처의 요청에서 인증 정보(쿠키 등)를 받아들이고 처리하도록 허용합니다.클라이언트 (JavaScript Fetch/Axios)fetch(url, { credentials: 'include' })클라이언트가 요청을 보낼 때 인증 정보(쿠키 등)를 포함하도록 브라우저에 지시합니다.필수 조건: credentials: true가 작동하려면, 서버 측 CORS 설정의 origin 값이 **절대 * (와일드카드)**가 될 수 없으며, 구체적인 출처(예: 'http://localhost:3000')로 설정되어야 합니다. 와일드카드와 credentials: true를 동시에 사용하는 것은 보안상의 이유로 허용되지 않습니다.3. 🌐 Socket.IO에서의 역할Socket.IO는 초기 연결을 수립할 때 HTTP 폴링을 사용하기 때문에, 클라이언트가 Socket.IO 서버에 연결할 때 세션 쿠키 등을 보내야 하는 경우에 credentials: true가 필요합니다.이를 통해 클라이언트는 기존에 로그인하면서 획득했던 세션 정보를 Socket.IO 연결에도 활용하여 자동으로 인증할 수 있게 됩니다.

🗺️ const rooms = new Map(); 는 무슨 의미인가요?const rooms = new Map(); 코드는 JavaScript에서 Map 객체를 새로 생성하고, 그 객체를 rooms 라는 이름의 상수(constant) 변수에 할당하는 코드입니다.이 코드가 Socket.IO 서버의 컨텍스트 내에서 사용된다면, 이는 일반적으로 실시간 채팅방(Room) 목록을 관리하는 데 사용됩니다.1. 🔑 Map 객체란?Map 객체는 **키(Key)**와 **값(Value)**의 쌍으로 이루어진 데이터를 저장하는 컬렉션입니다. Array나 일반 JavaScript 객체 {} 와는 다음과 같은 차이점이 있습니다.키의 자료형: Map은 모든 자료형을 키로 사용할 수 있습니다. (문자열뿐만 아니라 객체나 숫자도 키로 사용 가능)순서 보장: Map은 요소가 삽입된 순서대로 반복됩니다.성능: 키-값 쌍을 추가하고 접근하는 성능이 일반 객체보다 더 안정적입니다.2. 🏠 rooms Map의 역할 (Socket.IO 컨텍스트에서)Socket.IO 기반의 채팅 애플리케이션에서 이 rooms Map은 보통 다음과 같은 방식으로 사용됩니다.Map 구성 요소예시역할Key'general-chat', 'room-123'채팅방의 고유 ID 또는 이름Value{ name: '일반 채팅방', users: ['userA', 'userB'] }해당 방에 대한 정보 (방 이름, 현재 참여자 목록 등)📝 주요 사용 예시방 생성: 새로운 방이 생성될 때, 방 이름(Key)과 방 정보(Value)를 Map에 추가합니다.JavaScriptrooms.set('new-room', { userCount: 1, history: [] });
방 조회: 특정 방에 대한 정보를 빠르게 가져옵니다.JavaScriptconst roomInfo = rooms.get('new-room');
방 제거: 더 이상 사용되지 않는 방을 Map에서 제거합니다.JavaScriptrooms.delete('new-room');
3. const의 의미const는 상수를 선언하며, rooms 변수가 다른 값으로 재할당되는 것을 방지합니다.가능: rooms Map 내부의 데이터(키-값 쌍)는 set, delete 메서드를 통해 수정될 수 있습니다.불가능: rooms = new Map(); 처럼 rooms 변수 자체에 다른 Map이나 객체를 재할당하는 것은 불가능합니다.